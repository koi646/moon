# moon
a project about finding friends
#### 安装

在根目录执行'npm install'安装服务器依赖

然后进入webapp目录,'npm install'安装vue的相关依赖

####开发

webapp的开发只需要拉取**webapp**目录,
执行 'npm install'命令,安装相关依赖。

服务端开发需拉去整个项目。

-----
>   写在开发

项目架构采用 mongodb + vue + vuex + redis的形式,seesion储存在redis里面。email登录,暂时不用考虑其他形式登陆。
邮件系统需要模块 nodemailer


####产品
**用户只能看见自己的粉丝和关注,无法查看别人的粉丝和关注** （所以没必要关系链存redis里面了）
####问题
1.uid生成问题,现在暂时用mongo自己生成的objectId来代替。不过这特么也太丑了点,必须换掉
2.要充分利用缓存在提升性能
那redis中需要存的东西为:
* ~~用户好友关系（关注与被关注)~~
* 推荐的优质用户列表(热门数据缓存)
* 每个人的点赞数这种counter数据

####想法
1.用户的个人页面的数据利用h5可以做一个本地的缓存,更新数据库后,本地缓存也更新。那以后每次访问自己页面的时候就不需要再向服务器发起请求了（个人页面的数据利用本地存储来进行存储） 

本地持久化存储采用indexdb 不过需要用vue来对indexdb进行一层封装。

2.预加载,当用户访问一个页面的时候,对其他页面的数据进行预加载。 *我关注的*和  *关注我的* 页面
> 我关注的 因为只有自己能看见,所以前端应该对这个进行缓存,在自己没有取消关注的情况下,读取本地缓存数据,如果本地缓存没有,则发起请求读取数据库
我的粉丝 没法缓存,只能每次读取数据库,不过前端的话,可以缓存数据在本地,除了第一次点*我的粉丝*的 时候需要刷新，其他的时候不需要刷新（避免频繁请求数据库）。
前端增加下拉刷新功能,如果拉取的粉丝没有变化,则不需要重绘DOM。（这点在考虑第二版的时候增加websocket新增关注红点提示功能）

3.redis中到底是否需要存 关系链?
> 因为用户只能看见自己的粉丝和关注,无法查看别人的粉丝和关注,所以只需要再建两个model,以数组的形式:
```
{
  id: 'liyu',
  followers: [
    {
      id: 'liyu的follower',
      followeTime: '2015'
    }
  ]
}
```
以时间排序即可,性能不会出现问题？
4.online缓存
 
只能看见最近在线的30个同学（男或女）。而且最后在线时间也是缓存里面取的。
~~同时为了服务器性能,冒泡时间只在访问个人主页的时候才进行更新（微信访问经过个人主页）~~
因为是webapp的形式,所以只需要在webapp的初始化入口给服务器发个信息包,即可更新最近在线时间。
同时online中的最后在线改为最近在线时间。
同时,在用户访问个人主页的时候，服务器端还需要将用户的信息更新在redis中,online最近就从redis中获取。
5.周排行也要用缓存,存放用户的信息。
> 
业务层更新缓存策略为: 周排行的用户如果更新信息,比如被点赞,更改自己的简介,则需要更新redis里面对应的信息。
否则只写mongo,周排行读取的时候则对redis进行读取,若redis没有,则对mongo进行读取,并存在redis里面
